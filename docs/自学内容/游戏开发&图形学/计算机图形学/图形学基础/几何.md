### 隐式表述

- 数学表达式
  - 不告诉点都在哪，只告诉**点的位置是否满足的约束**（判断是否在几何上），如 `f(x,y,z)=0`
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230706233235852.png" alt="image-20230706233235852" style="zoom:33%;" />
- csg 法
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230706234848733.png" alt="image-20230706234848733" style="zoom:33%;" />
- 距离函数
  - 空间中任何一个点到物体表面的最短距离
  - 通过距离函数来得到几何形体混合的效果
  - 插值（应用）<img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230706235644170.png" alt="image-20230706235644170" style="zoom:33%;" />
    - 通过正负划分边界
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707001420918.png" alt="image-20230707001420918" style="zoom:33%;" />
- 分型描述（自相似）
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20240318230440273.png" style="zoom:33%;" />

#### SDF 距离场
- 场就是一个点/向量到向量/值的映射（如磁场就是从点到磁感应矢量）
- SDF 表示**一个点到一个曲面的最小距离**，同时用正负来区分点在曲面内外。**点在曲面内部则规定距离为负值，点在曲面外部则规定距离为正值，点在曲面上则距离为 0**.
- 二维 SDF：圆
	- ![image.png|380](https://thdlrt.oss-cn-beijing.aliyuncs.com/undefinedundefined20241212121400.png)
- 对于 $f(x,y,z)=\sqrt{x^2+y^2+z^2}-1$ 这样一个球体，其 SDF 函数就是
```glsl
float sphereSDF(vec3 p) {
    return length(p) - 1.0;
}
```
- 绘制 sdf 的片元着色器
```glsl
#version 330 core

out vec4 FragColor; // 输出颜色

// 圆形 SDF
float sdf_circle(vec2 p, float radius) {
    return length(p) - radius; // 点到圆心距离减去半径
}

void main() {
    // 获取当前片元的坐标，并映射到屏幕中心，归一化到[-1,1]
    vec2 iResolution = vec2(800.0, 600.0); // 固定屏幕分辨率
    vec2 uv = (gl_FragCoord.xy - 0.5 * iResolution) / iResolution.y;

    // 定义圆的半径
    float radius = 0.3;

    // 计算 SDF
    float d = sdf_circle(uv, radius);

    // 直接写死的颜色
    vec3 circleColor = vec3(1.0, 0.0, 0.0); // 圆的颜色：红色
    vec3 backgroundColor = vec3(0.0, 0.0, 0.0); // 背景颜色：黑色

    // 根据 SDF 绘制颜色
    vec3 color = mix(circleColor, backgroundColor, step(0.0, d));

    FragColor = vec4(color, 1.0);
}

```
- 常见几何体的 SDF 表述：[Inigo Quilez :: computer graphics, mathematics, shaders, fractals, demoscene and more](https://iquilezles.org/articles/distfunctions/)
### 显示表述

- 直接表示
  - 规定**平面图形**和二维到三维的**映射**
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230706233403094.png" alt="image-20230706233403094" style="zoom:33%;" />
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230706233636662.png" alt="image-20230706233636662" style="zoom:33%;" />
  - 区别隐式曲面与显示曲面的关键就在于是否可以直接表示出所有的点
  - 显示的问题在于**不容易判断**一个点在不在几何体上
- 点云表示 
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707205754492.png" alt="image-20230707205754492" style="zoom:33%;" />
- 多边形面
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707205819560.png" alt="image-20230707205819560" style="zoom:33%;" />


### 贝塞尔曲线

- <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707210656622.png" alt="image-20230707210656622" style="zoom:33%;" />
  - 两个端点、方向（切线）确定一条曲线
- 时间 t 贝塞尔曲线上的点
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707211233908.png" alt="image-20230707211233908" style="zoom:33%;" />
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707211258321.png" alt="image-20230707211258321" style="zoom:33%;" />
  - 将每个时间 t 的点连起来就得到了贝塞尔曲线
- 四点
  -  多次 t 划分**直至剩下一个点**
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707211546574.png" alt="image-20230707211546574" style="zoom:33%;" />
- <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707211724731.png" alt="image-20230707211724731" style="zoom:33%;" />
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707212011614.png" alt="image-20230707212011614" style="zoom:33%;" />
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20240318232516865.png" alt="image-20240318232516865" style="zoom:33%;" />
- 分段：点过多时不易于控制；贝塞尔曲线还具有凸包性质，在几个控制点限定的范围之内
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707213247492.png" alt="image-20230707213247492" style="zoom:33%;" />
  - 直接分段不够平滑（4 个点一段）<img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707213259047.png" alt="image-20230707213259047" style="zoom:33%;" />
  - c^0^连续：曲线首尾相接
  - c^1^连续：切线连续

- 不同的绘制方式
```cpp
void naive_bezier(const std::vector<cv::Point2f> &points, cv::Mat &window) 
{
    auto &p_0 = points[0];
    auto &p_1 = points[1];
    auto &p_2 = points[2];
    auto &p_3 = points[3];

    for (double t = 0.0; t <= 1.0; t += 0.001) 
    {
        auto point = std::pow(1 - t, 3) * p_0 + 3 * t * std::pow(1 - t, 2) * p_1 +
                 3 * std::pow(t, 2) * (1 - t) * p_2 + std::pow(t, 3) * p_3;

        window.at<cv::Vec3b>(point.y, point.x)[2] = 255;
    }
}

cv::Point2f recursive_bezier(const std::vector<cv::Point2f> &control_points, float t) 
{
    std::vector<cv::Point2f> _control_points = control_points;
    for(int i=0;i<_control_points.size()-1;i++)
    {
        for(int j=0;j<_control_points.size()-i-1;j++)
        {
            _control_points[j] = (1-t)*_control_points[j] + t*_control_points[j+1];
        }
    }
    return _control_points[0];
}
```
### 曲面

- 贝塞尔曲面
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20240318233552317.png" alt="image-20240318233552317" style="zoom: 25%;" /><img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707215834137.png" alt="image-20230707215834137" style="zoom: 25%;" />
  - **双重**贝塞尔曲线
  

#### 曲面细分

- 曲面细分的基本思路
  - 划分为**更多三角**形并**调整位置**使得更加贴近原先的图像
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707225708716.png" alt="image-20230707225708716" style="zoom:33%;" />

- 曲面**loop 细分**
  - **新顶点**（如每条边的**中点**）的位置由周围旧顶点的位置计算得到
    - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707230254250.png" alt="image-20230707230254250" style="zoom:33%;" />
    - 由周围旧点的加权平均得到
  - **旧顶点**的位置由原先的位置和周围点的位置决定
    - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707230347683.png" style="zoom:33%;" />
    - 相信自己也相信周围旧点，计算加权平均
- **Catmull-Clark 细分**（处理四边形面）
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707231458185.png" alt="image-20230707231458185" style="zoom:33%;" />
    - 称度不为 4 的点为**奇异点**
  - 连接边、面的中点
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707231505479.png" alt="image-20230707231505479" style="zoom:33%;" />
  - 非四边形会产生奇异点，非四边形面会在**细分之后消失**（做一次细分之后只有四边形面了，因此之后奇异点数目不会再发生变化，即**只有第一次细分时变化**）
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707231829386.png" alt="image-20230707231829386" style="zoom:33%;" />

#### 曲面简化

- 边坍缩
  - 删去边，捏成一个点
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707232409037.png" alt="image-20230707232409037" style="zoom:33%;" />
  - 用偏差（二次误差）计算新位置（到原先各面的**平方和最小**）
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707232521945.png" alt="image-20230707232521945" style="zoom:33%;" />
  - **优先坍缩**造成二次误差最小的边（使用优先队列）

#### 曲面正则化

- 曲面正则化（直到曲面简化，减少细节丢失）
  - <img src="https://thdlrt.oss-cn-beijing.aliyuncs.com/image-20230707220845910.png" alt="image-20230707220845910" style="zoom:33%;" />
### RayMatching
